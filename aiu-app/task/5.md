## Лекция: Углубление в функциональность Pinterest-подобной галереи: Детализация и улучшение UX

**Введение **

Сегодня мы сосредоточимся на улучшении пользовательского опыта и расширении функциональности нашей Pinterest-подобной галереи. Мы рассмотрим детализацию отображения отдельных изображений, добавим индикатор загрузки и улучшим обработку ошибок. Также коснемся оптимизации производительности и рассмотрим добавление анимаций.

**1. Детализация изображений**

*   **Переход на экран детализации:** Вместо простого `console.log` при нажатии на изображение, мы реализуем переход на отдельный экран, где будет отображаться полноразмерное изображение, описание (если оно есть) и дополнительная информация.
    *   Использование `React Navigation`: Краткий обзор установки и настройки навигации.
    *   Создание компонента `DetailScreen`:  Отображение информации об изображении и элементах управления (лайк, сохранение, поделиться).
*   **Передача данных на экран детализации:** Обсуждение способов передачи данных (id, uri, описание) от `ImageList` к `DetailScreen`.  Использование `navigation.navigate` с параметрами.

**2. Улучшение визуальной обратной связи и обработки ошибок**

*   **Индикатор загрузки (Loading Indicator):** Вместо простого `ActivityIndicator`, используем более информативный индикатор загрузки для каждого изображения.
    *   Использование `Image.getSize` для получения размеров изображения до его загрузки.
    *   Создание кастомного индикатора загрузки с прогрессом загрузки (опционально).
*   **Обработка ошибок загрузки изображений:**  Что делать, если изображение не загрузилось? Отображение placeholder-а или retry-кнопки.
    *   Использование `onError` обработчика в `Image` компоненте.
    *   Создание компонента `ErrorImagePlaceholder`.

**3. Оптимизация производительности**

*   **Мемоизация компонентов:** Использование `React.memo` для предотвращения ненужных перерисовок компонента `ImageItem`.
    *   Объяснение принципов мемоизации и ее пользы для производительности.
    *   Применение `React.memo` к компоненту `ImageItem`.
*   **Использование кастомных ключей для FlatList:**  Гарантия, что `keyExtractor` возвращает уникальные и стабильные ключи.
    *   Проблемы с ключами, сгенерированными на основе `Math.random()`.
    *   Использование id, полученного из API, или конкатенация строки и индекса для уникальности.

**4. Добавление анимаций**

*   **Плавные переходы:** Добавление простых анимаций для улучшения пользовательского опыта.
    *   Использование `Animated` API React Native.
    *   Примеры анимаций: fade-in при загрузке изображения, изменение размера и opacity при нажатии на лайк.

## Практическое задание: Детализация и обработка ошибок

**Цель:** Реализовать экран детализации изображения, добавить индикатор загрузки для каждого изображения и обработать ошибки загрузки изображений.

**Шаги:**

1.  **Установка React Navigation:**
    *   `npm install @react-navigation/native @react-navigation/stack react-native-reanimated react-native-gesture-handler react-native-screens react-native-safe-area-context @react-native-community/masked-view`
    *   (Для Expo) `expo install react-native-gesture-handler react-native-reanimated`
    *   Настроить `App.js` для использования React Navigation (добавление `NavigationContainer` и `Stack.Navigator`).

2.  **Создание компонента `DetailScreen`:**
    *   Создать новый компонент `DetailScreen.js`.
    *   Отобразить полноразмерное изображение и любой дополнительный текст (можно использовать mock-данные).
    *   Получить данные об изображении из `navigation.getParam`.
    *   Добавить кнопку "Назад" на экран детализации.

3.  **Изменение `ImageList`:**
    *   Добавить обработчик нажатия на `ImageItem`, который переходит на `DetailScreen`, передавая `id`, `uri` и (если есть) `description` изображения.

4.  **Добавление индикатора загрузки:**
    *   В компоненте `ImageItem` создать состояние `loading: true`.
    *   Внутри `<Image>` добавить `onLoadStart` и `onLoadEnd` обработчики.
    *   В `onLoadStart` установить `loading: true`.
    *   В `onLoadEnd` установить `loading: false`.
    *   Отобразить `ActivityIndicator` или кастомный индикатор загрузки, когда `loading` is `true`.

5.  **Обработка ошибок загрузки изображений:**
    *   В компоненте `ImageItem` добавить состояние `error: false`.
    *   Внутри `<Image>` добавить `onError` обработчик.
    *   В `onError` установить `error: true`.
    *   Если `error: true`, отобразить компонент `ErrorImagePlaceholder` (например, иконку сломанного изображения и текст "Ошибка загрузки").

**Бонусные задания:**

*   Реализовать кастомный индикатор загрузки с отображением прогресса.
*   Добавить кнопку "Retry" в компоненте `ErrorImagePlaceholder`, которая попытается перезагрузить изображение.
*   Использовать `React.memo` для мемоизации компонента `ImageItem`.

**Результат:**

После выполнения этого практического задания, ваше приложение будет иметь функциональный экран детализации, отображать индикаторы загрузки для каждого изображения и обрабатывать ошибки загрузки, обеспечивая более удобный и информативный пользовательский опыт.
